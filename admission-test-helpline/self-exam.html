<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∏‡ßá‡¶≤‡¶´ ‡¶è‡¶ï‡ßç‡¶∏‡¶æ‡¶Æ - Admission Test Helpline</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h2>Admission Test Helpline</h2>
        </div>
        <nav>
            <a href="dashboard.html">
                <i class="fas fa-dashboard"></i> ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°
            </a>
            <a href="question-bank.html">
                <i class="fas fa-question-circle"></i> ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï
            </a>
            <a href="self-exam.html" class="active">
                <i class="fas fa-pen"></i> ‡¶∏‡ßá‡¶≤‡¶´ ‡¶è‡¶ï‡ßç‡¶∏‡¶æ‡¶Æ
            </a>
            <a href="community.html">
                <i class="fas fa-users"></i> ‡¶ï‡¶Æ‡¶ø‡¶â‡¶®‡¶ø‡¶ü‡¶ø
            </a>
            <a href="my-saved.html">
                <i class="fas fa-bookmark"></i> ‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∏‡¶û‡ßç‡¶ö‡¶ø‡¶§
            </a>
        </nav>
    </div>

    <div class="main-content">
        <header>
            <h1 id="subject-title">‡¶∏‡ßá‡¶≤‡¶´ ‡¶è‡¶ï‡ßç‡¶∏‡¶æ‡¶Æ</h1>
            <div class="user-info">
                <span>‚è∞ ‡¶∏‡¶Æ‡¶Ø‡¶º: <span id="timer">‡ß©‡ß¶:‡ß¶‡ß¶</span></span>
                <span style="margin-left:20px;">‚≠ê ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: <span id="score">‡ß¶</span></span>
            </div>
        </header>

        <div class="quiz-container">
            <div class="quiz-header">
                <div>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® <span id="current-q">‡ßß</span>/<span id="total-q">‡ß¶</span></div>
            </div>
            
            <div class="question">
                <h3 id="question-text">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</h3>
                <div class="options" id="options"></div>
            </div>
            
            <div class="question-nav">
                <button class="nav-btn" onclick="window.location.href='question-bank.html'">
                    ‚Üê ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
                </button>
            </div>
        </div>
    </div>

    <script>
        // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶≠‡ßá‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶¨‡¶≤
        let questions = [];
        let currentIndex = 0;
        let score = 0;
        let timer;
        let timeLeft = 1800;
        
        // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡ßá‡¶∏
        let userProgress = {
            solved: 0,
            tests: 0,
            correct: 0
        };

        // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶™‡¶∞
        document.addEventListener('DOMContentLoaded', async function() {
            // URL ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßç‡¶Ø‡¶æ‡¶∞‡¶æ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶®‡¶ø‡¶®
            const urlParams = new URLSearchParams(window.location.search);
            const fileName = urlParams.get('file');
            const className = urlParams.get('class') || 'ssc';
            
            console.log('‡¶´‡¶æ‡¶á‡¶≤:', fileName, '‡¶ï‡ßç‡¶≤‡¶æ‡¶∏:', className);
            
            if (fileName) {
                // JSON ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                await loadJSON(fileName, className);
            } else {
                alert('‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø!');
                window.location.href = 'question-bank.html';
            }
        });

        // JSON ‡¶≤‡ßã‡¶° ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        async function loadJSON(fileName, className) {
            try {
                const response = await fetch(`data/${className}/${fileName}`);
                
                if (!response.ok) {
                    throw new Error(`‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø (${response.status})`);
                }
                
                const data = await response.json();
                console.log('JSON ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá:', data);
                
                // ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
                if (data.chapters && data.chapters.length > 0) {
                    data.chapters.forEach(chapter => {
                        if (chapter.questions && chapter.questions.length > 0) {
                            questions = questions.concat(chapter.questions);
                        }
                    });
                }
                
                // ‡¶ü‡¶æ‡¶á‡¶ü‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
                document.getElementById('subject-title').textContent = data.subject || fileName;
                document.getElementById('total-q').textContent = questions.length;
                
                // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                if (questions.length > 0) {
                    showQuestion();
                    startTimer();
                } else {
                    alert('‡¶è‡¶á ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á!');
                }
                
            } catch (error) {
                console.error('JSON ‡¶≤‡ßã‡¶° ‡¶è‡¶∞‡¶∞:', error);
                alert(`"${fileName}" ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!\n\n‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶•: data/${className}/${fileName}\n\n‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®:\n1. ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ\n2. ‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ`);
                
                // ‡¶°‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
                showDemoQuestions();
            }
        }

        // ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
        function showQuestion() {
            if (!questions || questions.length === 0) return;
            
            const q = questions[currentIndex];
            document.getElementById('question-text').textContent = q.question;
            document.getElementById('current-q').textContent = currentIndex + 1;
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = q.options.map((opt, index) => `
                <div class="option" onclick="checkAnswer(${index})">
                    ${String.fromCharCode(65 + index)}. ${opt}
                </div>
            `).join('');
        }

        // ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ö‡ßá‡¶ï
        function checkAnswer(selectedIndex) {
            const q = questions[currentIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach(opt => opt.style.pointerEvents = 'none');
            options[q.correct].classList.add('correct');
            
            if (selectedIndex === q.correct) {
                score += 4;
                userProgress.correct++;
            } else {
                options[selectedIndex].classList.add('wrong');
                score -= 1;
            }
            
            document.getElementById('score').textContent = score;
            
            // ‡¶™‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®
            setTimeout(() => {
                currentIndex++;
                if (currentIndex < questions.length) {
                    showQuestion();
                    // ‡¶Ö‡¶™‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®
                    document.querySelectorAll('.option').forEach(opt => {
                        opt.style.pointerEvents = 'auto';
                        opt.classList.remove('correct', 'wrong');
                    });
                } else {
                    endQuiz();
                }
            }, 1500);
        }

        // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞
        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    endQuiz();
                }
            }, 1000);
        }

        // ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßá‡¶∑
        function endQuiz() {
            clearInterval(timer);
            
            // ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
            userProgress.solved += questions.length;
            userProgress.tests++;
            localStorage.setItem('admissionTestHelpline', JSON.stringify(userProgress));
            
            alert(`‚úÖ ‡¶ï‡ßÅ‡¶á‡¶ú ‡¶∂‡ßá‡¶∑!\n\nüìä ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞: ${score}\n‚úÖ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: ${userProgress.correct}\nüìù ‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®: ${questions.length}`);
            window.location.href = 'dashboard.html';
        }

        // ‡¶°‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®
        function showDemoQuestions() {
            questions = [
                {
                    question: "‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶°‡ßá‡¶Æ‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ JSON ‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§",
                    options: [
                        "data/ssc/ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá bangla.json ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
                        "‡¶´‡¶æ‡¶á‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
                        "JSON ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®",
                        "‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã"
                    ],
                    correct: 3
                }
            ];
            
            document.getElementById('total-q').textContent = questions.length;
            showQuestion();
            startTimer();
        }
    </script>
</body>
</html>